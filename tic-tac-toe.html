<html>
  <head>
    <title>Tic Tac Toe</title>
    <style>
      .content {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .gameGrid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(4, 1fr);
        grid-column-gap: 15px;
        grid-row-gap: 15px;
        height: min(100dvh, 100dvh);
        width: min(100dvh, 100dvh);
      }

      .ticTacToeButton {
        aspect-ratio: 1;
        height: 100%;
        width: 100%;
        color: black;
        font-size: 200%;
      }

      button {
        min-height: 40px;
        width: 100%;
      }

      .actions {
        grid-area: 4 / 1 / 5 / 4;
        aspect-ratio: auto;
      }

      .reset {
        margin-top: 20px;
        width: 100%;
      }

      .winner-line {
        width: 2px;
        position: absolute;
        height: 100%;
        background-color: red;
        display: none;
      }
    </style>
    <script>
      var numberOfTurns = 0;
      var currentTurn = "x";
      var currentStateOfGame = [];

      var winningCombos = [
        //diagonal
        [0, 4, 8],
        [2, 4, 6],
        //rows
        [0, 1, 2],
        [3, 4, 5],
        [6, 7, 8],
        //cols
        [0, 3, 6],
        [1, 4, 7],
        [2, 5, 8],
      ];

      const rowRegEx = new RegExp(/row(\d)/);
      const colRegEx = new RegExp(/col(\d)/);

      var onGameClick = (id) => {
        console.log(`'${currentTurn}' took a turn! Turn ${numberOfTurns}`);
        numberOfTurns++;
        let currentButton = document.getElementById(id);
        currentButton.textContent = currentTurn;
        currentButton.setAttribute("disabled", "true");
        calculateWinner(id, currentTurn);
        currentTurn = currentTurn === "x" ? "o" : "x";
      };

      var onReset = () => {
        currentTurn = "x";
        numberOfTurns = 0;
        currentStateOfGame = [];
        const allButtons = document.getElementsByClassName("ticTacToeButton");
        for (let b of allButtons) {
          b.textContent = "";
          b.removeAttribute("disabled");
        }
      };

      var disableAllButtons = () => {
        const allGameButtons =
          document.getElementsByClassName("ticTacToeButton");
        for (const b of allGameButtons) {
          b.setAttribute("disabled", "true");
        }
      };

      var onWin = () => {
        console.log("Someone won!!!!");
        disableAllButtons();
      };

      var calculateWinner = (id, currTurn) => {
        // somehow we calculate the winner
        const row = id.match(rowRegEx)[1];
        const col = id.match(colRegEx)[1];
        currentStateOfGame[(row - 1) * 3 + (col - 1)] = currTurn;
        // Get all 3 series to see if they match
        for (const winningCombo of winningCombos) {
          let isWin = true;
          for (const win of winningCombo) {
            if (currentStateOfGame[win] === currTurn) {
              // potentially
            } else {
              isWin = false;
            }
          }
          if (isWin) {
            onWin();
          }
        }

        console.log(currentStateOfGame);
        // todo - figure out who won and then draw the red line
      };
    </script>
  </head>
  <body>
    <div class="content">
      <div class="winner-line"></div>
      <div class="gameGrid">
        <button
          id="row1col1"
          class="ticTacToeButton"
          onclick="onGameClick('row1col1')"
        ></button>
        <button
          id="row1col2"
          class="ticTacToeButton"
          onclick="onGameClick('row1col2')"
        ></button>
        <button
          id="row1col3"
          class="ticTacToeButton"
          onclick="onGameClick('row1col3')"
        ></button>
        <button
          id="row2col1"
          class="ticTacToeButton"
          onclick="onGameClick('row2col1')"
        ></button>
        <button
          id="row2col2"
          class="ticTacToeButton"
          onclick="onGameClick('row2col2')"
        ></button>
        <button
          id="row2col3"
          class="ticTacToeButton"
          onclick="onGameClick('row2col3')"
        ></button>
        <button
          id="row3col1"
          class="ticTacToeButton"
          onclick="onGameClick('row3col1')"
        ></button>
        <button
          id="row3col2"
          class="ticTacToeButton"
          onclick="onGameClick('row3col2')"
        ></button>
        <button
          id="row3col3"
          class="ticTacToeButton"
          onclick="onGameClick('row3col3')"
        ></button>
        <div class="actions">
          <button class="reset" onclick="onReset()">Reset</button>
        </div>
      </div>
    </div>
  </body>
</html>
