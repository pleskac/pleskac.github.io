<html>
  <head>
    <title>Tic Tac Toe</title>
    <style>
      body {
        margin: 0;
      }

      .content {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 8px;

        height: 100dvh;
        width: 100dvw;
      }

      .gameGridWrapper {
        max-width: min(100dvw, 100dvh);
        max-height: min(100dvw, 100dvh);
        flex-grow: 1;
        flex-shrink: 1;
        flex-basis: 100%;
        aspect-ratio: 1;
        position: relative;
      }

      .gameGrid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
        grid-column-gap: 15px;
        grid-row-gap: 15px;
        aspect-ratio: 1;
      }

      .ticTacToeButton {
        aspect-ratio: 1;
        height: 100%;
        width: 100%;
        color: black;
        font-size: 200%;
      }

      button {
        min-height: 40px;
        width: 100%;
        padding: 8px;
      }

      .actions {
        flex-shrink: 0;
        flex-grow: 0;
      }

      .reset {
        margin-top: 20px;
        width: 100%;
      }

      .winner-line-hide {
        display: none;
        position: absolute;
      }

      .winner-line-show {
        position: absolute;
        height: 100%;
        width: 100%;
        border-left: 2px solid red;
        pointer-events: none;
      }
    </style>
    <script>
      var numberOfTurns = 0;
      var currentTurn = "x";
      var currentStateOfGame = [];

      var winningCombos = [
        //diagonal
        { win: [0, 4, 8], line: { x: "50%", y: 0, rotate: "-45deg" } },
        { win: [2, 4, 6], line: { x: "50%", y: 0, rotate: "45deg" } },
        //rows
        {
          win: [0, 1, 2],
          line: { x: "calc(16.5% - 1px)", y: 0, rotate: "90deg" },
        },
        {
          win: [3, 4, 5],
          line: { x: "calc(50% - 1px)", y: 0, rotate: "90deg" },
        },
        {
          win: [6, 7, 8],
          line: { x: "calc(83.5% - 1px)", y: 0, rotate: "90deg" },
        },
        //cols
        {
          win: [0, 3, 6],
          line: { x: "calc(16.5% - 1px)", y: 0, rotate: "0deg" },
        },
        {
          win: [1, 4, 7],
          line: { x: "calc(50% - 1px)", y: 0, rotate: "0deg" },
        },
        {
          win: [2, 5, 8],
          line: { x: "calc(83.5% - 1px)", y: 0, rotate: "0deg" },
        },
      ];

      const rowRegEx = new RegExp(/row(\d)/);
      const colRegEx = new RegExp(/col(\d)/);

      var onGameClick = (id) => {
        console.log(`'${currentTurn}' took a turn! Turn ${numberOfTurns}`);
        numberOfTurns++;
        let currentButton = document.getElementById(id);
        currentButton.textContent = currentTurn;
        currentButton.setAttribute("disabled", "true");
        calculateWinner(id, currentTurn);
        currentTurn = currentTurn === "x" ? "o" : "x";
      };

      var onReset = () => {
        currentTurn = "x";
        numberOfTurns = 0;
        currentStateOfGame = [];
        const allButtons = document.getElementsByClassName("ticTacToeButton");
        for (let b of allButtons) {
          b.textContent = "";
          b.removeAttribute("disabled");
        }

        const statusSpan = document.getElementById("status-span");
        statusSpan.textContent = "Click the buttons to play!";

        const winnerLine = document.getElementById("winner-line");
        winnerLine.setAttribute("class", "winner-line-hide");
      };

      var disableAllButtons = () => {
        const allGameButtons =
          document.getElementsByClassName("ticTacToeButton");
        for (const b of allGameButtons) {
          b.setAttribute("disabled", "true");
        }
      };

      var onWin = (line) => {
        console.log("Someone won!!!!", line);
        const statusSpan = document.getElementById("status-span");
        statusSpan.textContent = `${currentTurn} won! Click reset to play again!`;
        disableAllButtons();

        const winnerLine = document.getElementById("winner-line");
        winnerLine.setAttribute("class", "winner-line-show");
        winnerLine.setAttribute(
          "style",
          `rotate: ${line.rotate}; transform: translate3d(${line.x}, ${line.y}, 0);`
        );
      };

      var calculateWinner = (id, currTurn) => {
        // somehow we calculate the winner
        const row = id.match(rowRegEx)[1];
        const col = id.match(colRegEx)[1];
        currentStateOfGame[(row - 1) * 3 + (col - 1)] = currTurn;
        // Get all 3 series to see if they match
        for (const winningCombo of winningCombos) {
          let isWin = true;
          for (const win of winningCombo.win) {
            if (currentStateOfGame[win] === currTurn) {
              // potentially
            } else {
              isWin = false;
            }
          }
          if (isWin) {
            onWin(winningCombo.line);
          }
        }

        console.log(currentStateOfGame);
        // todo - figure out who won and then draw the red line
      };
    </script>
  </head>
  <body>
    <div class="content">
      <div></div>
      <div class="gameGridWrapper">
        <div id="winner-line" class="winner-line-hide"></div>
        <div class="gameGrid">
          <button
            id="row1col1"
            class="ticTacToeButton"
            onclick="onGameClick('row1col1')"
          ></button>
          <button
            id="row1col2"
            class="ticTacToeButton"
            onclick="onGameClick('row1col2')"
          ></button>
          <button
            id="row1col3"
            class="ticTacToeButton"
            onclick="onGameClick('row1col3')"
          ></button>
          <button
            id="row2col1"
            class="ticTacToeButton"
            onclick="onGameClick('row2col1')"
          ></button>
          <button
            id="row2col2"
            class="ticTacToeButton"
            onclick="onGameClick('row2col2')"
          ></button>
          <button
            id="row2col3"
            class="ticTacToeButton"
            onclick="onGameClick('row2col3')"
          ></button>
          <button
            id="row3col1"
            class="ticTacToeButton"
            onclick="onGameClick('row3col1')"
          ></button>
          <button
            id="row3col2"
            class="ticTacToeButton"
            onclick="onGameClick('row3col2')"
          ></button>
          <button
            id="row3col3"
            class="ticTacToeButton"
            onclick="onGameClick('row3col3')"
          ></button>
        </div>
      </div>
      <div class="actions">
        <span id="status-span">Click the buttons to play!</span>
        <button class="reset" onclick="onReset()">Reset</button>
      </div>
      <div></div>
    </div>
  </body>
</html>
